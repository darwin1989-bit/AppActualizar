<hr />
<div class="flex align-items-center justify-content-between mt-5">
  <h4 class="my-0 font-bold">Resultados materiales matriz</h4>
</div>
<div class="grid mt-3">
  <div class="col-12 md:col-12">
    <div class="card surface-card">
      <div class="flex align-items-center justify-content-between">
        <h4 class="my-0">Resultados materiales matriz</h4>
      </div>
      <hr />
      <p-table
        #dt
        [value]="materials"
        styleClass="p-datatable-sm p-datatable-gridlines"
        [rows]="5"
        [rowsPerPageOptions]="[5, 10, 25, 50]"
        [scrollable]="true"
        [breakpoint]="'960px'"
        rowGroupMode="rowspan"
        groupRowsBy="codigo"
        [groupRowsByOrder]="0"
        editMode="row"
        dataKey="codBarra"
      >
        <ng-template pTemplate="header">
          <tr>
            <th pFrozenColumn>Código</th>
            <th>Descripción</th>
            <th>Rest. desc.</th>
            <th>Precio</th>
            <th>Estado</th>
            <th>Marca</th>
            <th>Código Barra</th>
            <th>Principal</th>
            <th>Orden</th>
            <th style="width: 8%">Estado cod. barras</th>
            <th>Editar</th>
            <th>Comun.</th>
          </tr>
        </ng-template>
        <ng-template pTemplate="body" let-material let-rowIndex="rowIndex" let-rowgroup="rowgroup" let-rowspan="rowspan" let-editing="editing">
          <tr [pEditableRow]="material">
            <td pFrozenColumn *ngIf="rowgroup" [attr.rowspan]="rowspan">{{ material.codigo }}</td>
            <td *ngIf="rowgroup" [attr.rowspan]="rowspan">{{ material.descripcion }}</td>
            <td *ngIf="rowgroup" [attr.rowspan]="rowspan" [class.border-red-200]="editing" [class.border-1]="editing">
              <p-cellEditor>
                <ng-template pTemplate="input">
                  <p-dropdown [options]="statusesDesc" appendTo="body" [(ngModel)]="material.restringidoDesc" [style]="{ width: '100%' }"></p-dropdown>
                </ng-template>
                <ng-template pTemplate="output">
                  {{ material.restringidoDesc == "N" ? "No " : "Si" }}
                </ng-template>
              </p-cellEditor>
            </td>
            <td *ngIf="rowgroup" [attr.rowspan]="rowspan">{{ material.precio | currency : moneyLocale.money : "symbol" : "" : moneyLocale.locale }}</td>
            <td *ngIf="rowgroup" [attr.rowspan]="rowspan" [class.border-red-200]="editing" [class.border-1]="editing">
              <p-cellEditor>
                <ng-template pTemplate="input">
                  <p-dropdown [options]="statusesCod" appendTo="body" [(ngModel)]="material.estado" [style]="{ width: '100%' }"></p-dropdown>
                </ng-template>
                <ng-template pTemplate="output">
                  {{ material.estado == "A" ? "Activo" : "Inactivo" }}
                </ng-template>
              </p-cellEditor>
            </td>
            <td *ngIf="rowgroup" [attr.rowspan]="rowspan">{{ material.marca }}</td>
            <td [class.font-italic]="!material.codBarra">{{ material.codBarra ? material.codBarra : "NULL" }}</td>
            <td [class.font-italic]="!material.codBarra" [class.border-red-200]="editing" [class.border-1]="editing">
              <p-cellEditor>
                <ng-template pTemplate="input">
                  <p-dropdown [options]="statusesEsPrincipal" appendTo="body" [(ngModel)]="material.esPrincipal" [style]="{ width: '100%' }"></p-dropdown>
                </ng-template>
                <ng-template pTemplate="output">
                  {{ material.esPrincipal == "S" ? "Si" : "No" }}
                </ng-template>
              </p-cellEditor>
            </td>
            <td [class.font-italic]="!material.codBarra">{{ material.orden ? material.orden : "NULL" }}</td>
            <td [class.border-red-200]="editing" [class.border-1]="editing">
              <p-cellEditor>
                <ng-template pTemplate="input">
                  <p-dropdown [options]="statuses" appendTo="body" [(ngModel)]="material.estadoCodBarra" [style]="{ width: '100%' }"></p-dropdown>
                </ng-template>
                <ng-template pTemplate="output">
                  {{ material.estadoCodBarra == "A" ? "Activo" : "Inactivo" }}
                </ng-template>
              </p-cellEditor>
            </td>
            <td>
              <div class="flex align-items-center gap-2">
                <button *ngIf="!editing" pButton pRipple type="button" pInitEditableRow icon="pi pi-pencil" (click)="onRowEditInit(material)" class="p-button-warning"></button>
                <button *ngIf="editing" pButton pRipple type="button" pSaveEditableRow icon="pi pi-check" (click)="onRowEditSave(material)" class="p-button-success mr-2"></button>
                <button *ngIf="editing" pButton pRipple type="button" pCancelEditableRow icon="pi pi-times" (click)="onRowEditCancel(material, rowIndex)" class="p-button-danger"></button>
              </div>
            </td>
            <td *ngIf="rowgroup" [attr.rowspan]="rowspan">
              <button pButton pRipple icon="pi pi-sync" class="p-button-info p-button-sm" (click)="procedure(material)" [disabled]="material.spDisabled"></button>
            </td>
          </tr>
        </ng-template>

        <ng-template pTemplate="emptymessage">
          <tr>
            <td colspan="12" class="font-normal py-4">No existen datos que mostrar.</td>
          </tr>
        </ng-template>
      </p-table>
    </div>
  </div>
</div>
